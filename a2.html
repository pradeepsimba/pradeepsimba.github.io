<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="12.png" type="image/icon type">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2 Configurations</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">
    <div class="card shadow p-4">
        <h2 class="text-center mb-4">A2 Configurations</h2>
        
        <div class="mb-3">
            <label for="port1" class="form-label">Enter website Port:</label>
            <input type="number" id="port1" class="form-control" value="8101">
        </div>
        
        <div class="mb-3">
            <label for="port2" class="form-label">Enter gunicorn Port:</label>
            <input type="number" id="port2" class="form-control" value="81">
        </div>
        
        <div class="mb-3">
            <label for="djangoContainer" class="form-label">Enter Django Container Name:</label>
            <input type="text" id="djangoContainer" class="form-control" value="stp_dp_2.0">
        </div>
        
        <button class="btn btn-primary w-100 mb-3" onclick="generateConfig()">Generate Config</button>
        
        <h3 class="mt-4">Generated Nginx Configuration:</h3>
        <textarea id="configOutput" class="form-control" rows="6" readonly></textarea>
        
        <h3 class="mt-4">Generated Docker Compose:</h3>
        <textarea id="composeOutput" class="form-control" rows="6" readonly></textarea>
        
        <h3 class="mt-4">Generated Dockerfile:</h3>
        <textarea id="dockerfileOutput" class="form-control" rows="6" readonly></textarea>
        
        <h3 class="mt-4">Generated Django Settings:</h3>
        <textarea id="djangoSettings" class="form-control" rows="6" readonly></textarea>
        
        <h3 class="mt-4">Remove Old Containers:</h3>
        <textarea id="remove_old_containers" class="form-control" rows="3" readonly></textarea>
        
        <h3 class="mt-4">Follow Docker Logs:</h3>
        <textarea id="docker_logs" class="form-control" rows="3" readonly></textarea>
    </div>

    <script>
        function generateConfig() {
            const port1 = document.getElementById('port1').value;
            const port2 = document.getElementById('port2').value;
            const djangoContainer = document.getElementById('djangoContainer').value;
            const nginxContainer = djangoContainer + "_nginx";  // Append "_nginx" to the Django container name
            
            // Nginx Configuration
            const nginxConfig = `server {
    listen ${port1} ssl;
    server_name a2.mpulse.plus;

    ssl_certificate /etc/nginx/ssl/a2.mpulse.plus.crt;
    ssl_certificate_key /etc/nginx/ssl/a2_mpulse_plus_private.key;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256";
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 1d;
    ssl_session_tickets off;
    ssl_stapling on;
    ssl_stapling_verify on;
    resolver 8.8.8.8 8.8.4.4 valid=300s;
    resolver_timeout 5s;

    client_max_body_size 500M;

    location / {
        proxy_pass http://${djangoContainer}:${port2};
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
    }

    location /static/ {
        alias /app/static/;
    }
}`;

            // Docker Compose Configuration
            const composeConfig = `services:
  django_app:
    container_name: ${djangoContainer}
    build: .
    expose:
      - "${port2}"
    environment:
      - DJANGO_ALLOWED_HOSTS=a2.mpulse.plus
    volumes:
      - .:/app
      - static_volume:/app/static
    restart: always

  nginx:
    container_name: ${nginxContainer}
    image: nginx:latest
    ports:
      - "${port1}:${port1}"
      - "443:443"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
      - static_volume:/app/static
      - ./certs:/etc/nginx/ssl  
    depends_on:
      - django_app
    restart: always

volumes:
  static_volume:`;

            // Dockerfile
            const dockerfileConfig = `# Use the official Python image
FROM python:latest

# Set the working directory in the container
WORKDIR /app

# Copy the project files into the container
COPY . /app/

# Install dependencies
RUN pip install --no-cache-dir -r req.txt

# Collect static files
RUN python manage.py collectstatic --noinput

RUN pip install gunicorn

# Expose port for Gunicorn
EXPOSE ${port2}

# Start the Django application with Gunicorn
CMD ["gunicorn", "--bind", "0.0.0.0:${port2}", "amazon.wsgi:application"]`;

            // Django Settings Configuration
            const djangoSettings = `CSRF_TRUSTED_ORIGINS = ["https://a2.mpulse.plus:${port1}"]
ALLOWED_HOSTS = ['a2.mpulse.plus', 'localhost']

CSRF_COOKIE_SECURE = True
SESSION_COOKIE_SECURE = True
CSRF_USE_SESSIONS = True

DATA_UPLOAD_MAX_MEMORY_SIZE = 1000 * 1024 * 1024
FILE_UPLOAD_MAX_MEMORY_SIZE = 1000 * 1024 * 1024`;

            // Remove old containers command
            const removeOldContainers = `docker stop ${djangoContainer} ${nginxContainer} && docker rm ${djangoContainer} ${nginxContainer} && docker container prune -f && docker system prune -a -f`;

            // Follow Docker logs command
            const dockerLogsCommand = `docker logs -f ${djangoContainer}`;

            // Set the output values
            document.getElementById('configOutput').value = nginxConfig;
            document.getElementById('composeOutput').value = composeConfig;
            document.getElementById('dockerfileOutput').value = dockerfileConfig;
            document.getElementById('djangoSettings').value = djangoSettings;
            document.getElementById('remove_old_containers').value = removeOldContainers;
            document.getElementById('docker_logs').value = dockerLogsCommand;
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
